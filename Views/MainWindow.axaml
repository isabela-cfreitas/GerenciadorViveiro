<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:GerenciadorViveiro.ViewModels"
        xmlns:converters="using:GerenciadorViveiro"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="550"
        x:Class="GerenciadorViveiro.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Gerenciador de Vendas"
        Width="900" Height="550">

    <Window.Resources>
        <converters:DecimalConverter x:Key="DecimalConverter"/>
    </Window.Resources>

    <TabControl SelectionChanged="OnTabSelectionChanged">
        <!-- TAB CONFIGURA√á√ïES -->
        <TabItem Header="Configura√ß√µes" FontSize="20">
            <Grid Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="20"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="20"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- T√≠tulo -->
                <TextBlock Grid.Row="0"
                           Text="Configura√ß√µes de Pastas"
                           FontSize="18"
                           FontWeight="Bold"
                           Margin="0,0,0,20"/>

                <!-- Pasta de Vendas -->
                <StackPanel Grid.Row="2" Spacing="10">
                    <TextBlock Text="Pasta do arquivo de vendas:"
                               FontWeight="SemiBold"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBox Grid.Column="0"
                                 Text="{Binding ConfiguracoesVM.PastaVendas, Mode=TwoWay}"
                                 Watermark="C:/Users/Usuario/Dropbox"
                                 Margin="0,0,10,0"/>
                        <Button Grid.Column="1"
                                Content="üìÅ Procurar"
                                Click="SelecionarPastaVendas"
                                Padding="15,8"/>
                    </Grid>
                    <TextBlock Text="O arquivo 'vendas.xlsx' ser√° criado/lido nesta pasta"
                               FontSize="11"
                               Foreground="Gray"
                               Margin="5,0,0,0"/>
                </StackPanel>

                <!-- Pasta de Custos -->
                <StackPanel Grid.Row="4" Spacing="10">
                    <TextBlock Text="Pasta dos arquivos de custos:"
                               FontWeight="SemiBold"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBox Grid.Column="0"
                                 Text="{Binding ConfiguracoesVM.PastaCustos, Mode=TwoWay}"
                                 Watermark="C:/Users/Usuario/Dropbox/Custos"
                                 Margin="0,0,10,0"/>
                        <Button Grid.Column="1"
                                Content="üìÅ Procurar"
                                Click="SelecionarPastaCustos"
                                Padding="15,8"/>
                    </Grid>
                    <TextBlock Text="Os arquivos 'custos_ANO_MES.xlsx' ser√£o criados/lidos nesta pasta"
                               FontSize="11"
                               Foreground="Gray"
                               Margin="5,0,0,0"/>
                </StackPanel>

                <!-- Info adicional -->
                <Border Grid.Row="5"
                        Background="#F5F5F5"
                        CornerRadius="5"
                        Padding="15"
                        Margin="0,30,0,0"
                        VerticalAlignment="Top">
                </Border>
            </Grid>
        </TabItem>

        <!-- TAB VENDAS -->
        <TabItem Header="Vendas" FontSize="20">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Filtro -->
                <StackPanel Grid.Row="0"
                            Orientation="Horizontal"
                            VerticalAlignment="Top"
                            Margin="0,0,0,8">
                    <TextBlock Text="Cliente:"
                            VerticalAlignment="Center"
                            Margin="0,0,6,0"/>
                    <TextBox Width="180"
                            Height="28"
                            Watermark="Filtrar..."
                            Text="{Binding VendasVM.FiltroCliente, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <!-- Tabela -->
                <Border Grid.Row="1"
                    BorderBrush="#CCCCCC"
                    BorderThickness="1"
                    CornerRadius="5">
                    <DataGrid x:Name="VendasDataGrid"
                        ItemsSource="{Binding VendasVM.VendasFiltradas}"
                        AutoGenerateColumns="False"
                        IsReadOnly="False"
                        GridLinesVisibility="All"
                        SelectionMode="Extended"
                        CanUserReorderColumns="True"
                        CanUserResizeColumns="True">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="Data" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Data, StringFormat='{}{0:dd/MM/yyyy}'}" 
                                                VerticalAlignment="Center" 
                                                Margin="5,0"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <CalendarDatePicker SelectedDate="{Binding Data, Mode=TwoWay}" 
                                                            HorizontalAlignment="Stretch"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Planta" 
                                                Binding="{Binding Planta}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="Quantidade" 
                                                Binding="{Binding Quantidade}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="Valor unit√°rio" 
                                                Binding="{Binding Valor, Converter={StaticResource DecimalConverter}}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="Valor total" 
                                                Binding="{Binding ValorTotal, StringFormat='C2'}" 
                                                IsReadOnly="True"
                                                Width="*"/>
                            <DataGridTextColumn Header="Cliente" 
                                                Binding="{Binding Cliente}" 
                                                Width="*"/>
                            <DataGridTemplateColumn Header="Forma de Pagamento" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding FormaPagamento}" 
                                                VerticalAlignment="Center" 
                                                Margin="5,0"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <ComboBox SelectedItem="{Binding FormaPagamento, Mode=TwoWay}"
                                                HorizontalAlignment="Stretch">
                                            <x:String>Dinheiro</x:String>
                                            <x:String>Pix</x:String>
                                            <x:String>Cart√£o de Cr√©dito</x:String>
                                            <x:String>Cart√£o de D√©bito</x:String>
                                            <x:String>Cheque</x:String>
                                            <x:String>Anotado</x:String>
                                        </ComboBox>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>

                <!-- Bot√µes -->
                <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,10,0,0">
                    <Button Content="Nova Linha" 
                            Command="{Binding VendasVM.NovaLinhaCommand}"
                            Background="#4CAF50" Foreground="White"
                            Padding="20,8" Margin="5"/>
                    <Button Content="Excluir Linha(s)" 
                            Command="{Binding VendasVM.ExcluirLinhasCommand}"
                            Background="#F44336" Foreground="White"
                            Padding="20,8" Margin="5"/>
                    <Button Content="Salvar" 
                            Command="{Binding VendasVM.SalvarCommand}"
                            Background="#2196F3" Foreground="White"
                            Padding="20,8" Margin="5"/>
                </StackPanel>
            </Grid>
        </TabItem>
        
        <!-- TAB FREQU√äNCIAS -->
        <TabItem Header="Frequ√™ncias" Tapped="CalcularFrequencias" FontSize="20">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Sele√ß√£o de per√≠odo -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBlock Text="Ano:"
                            VerticalAlignment="Center"
                            Margin="0,0,5,0"/>
                    <TextBox Width="100"
                        Text="{Binding FrequenciasVM.AnoSelecionado, Mode=TwoWay}"
                        Watermark="Ano"/>

                    <TextBlock Text="M√™s:"
                            VerticalAlignment="Center"
                            Margin="15,0,5,0"/>
                    <TextBox Width="80"
                        Margin="15,0,0,0"
                        Text="{Binding FrequenciasVM.MesSelecionado, Mode=TwoWay}"
                        Watermark="M√™s (1‚Äì12)"/>
                </StackPanel>

                <!-- Tabela -->
                <Border Grid.Row="1" BorderBrush="#CCCCCC" BorderThickness="1" 
                        CornerRadius="5">
                    <DataGrid x:Name="FrequenciasGrid"
                        ItemsSource="{Binding FrequenciasVM.Frequencias}"
                        AutoGenerateColumns="False"
                        IsReadOnly="True"
                        GridLinesVisibility="All"
                        SelectionMode="Extended"
                        CanUserReorderColumns="True"
                        CanUserResizeColumns="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Planta"
                                                Binding="{Binding Planta}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="Quantidade" 
                                                Binding="{Binding Quantidade}"
                                                Width="*"/>
                            <DataGridTextColumn Header="Valor" 
                                                Binding="{Binding Valor, Converter={StaticResource DecimalConverter}}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="Valor total" 
                                                Binding="{Binding ValorTotal, StringFormat='C2'}" 
                                                Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </Grid>
        </TabItem>

        <!-- TAB CUSTOS -->
        <TabItem Header="Custos" FontSize="20">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Sele√ß√£o m√™s/ano -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBlock Text="Ano:" Margin="0,0,5,0"/>
                    <TextBox Width="100"
                        Text="{Binding CustosVM.AnoSelecionado, Mode=TwoWay}"
                        Watermark="Ano"/>

                    <TextBlock Text="M√™s:" Margin="15,0,5,0"/>
                    <TextBox Width="80"
                        Margin="15,0,0,0"
                        Text="{Binding CustosVM.MesSelecionado, Mode=TwoWay}"
                        Watermark="M√™s (1‚Äì12)"/>
                </StackPanel>

                <!-- Tabela -->
                <DataGrid Grid.Row="1"
                        x:Name="CustosDataGrid"
                        ItemsSource="{Binding CustosVM.Custos}"
                        AutoGenerateColumns="False"
                        GridLinesVisibility="All"
                        SelectionMode="Extended"
                        CanUserReorderColumns="True"
                        CanUserResizeColumns="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Atividade" Binding="{Binding Atividade}"/>
                        <DataGridTextColumn Header="Elemento" Binding="{Binding Elemento}"/>
                        <DataGridTextColumn Header="Quantidade" Binding="{Binding Quantidade}"/>
                        <DataGridTextColumn Header="Valor Total" Binding="{Binding ValorTotal}"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Bot√µes -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                    <Button Content="Nova Linha" 
                            Command="{Binding CustosVM.NovaLinhaCommand}"
                            Background="#4CAF50" Foreground="White"
                            Padding="20,8" Margin="5"/>
                    <Button Content="Excluir Linha(s)" 
                            Command="{Binding CustosVM.ExcluirLinhasCommand}"
                            Background="#F44336" Foreground="White"
                            Padding="20,8" Margin="5"/>
                    <Button Content="Salvar" 
                            Command="{Binding CustosVM.SalvarCustosCommand}"
                            Background="#2196F3" Foreground="White"
                            Padding="20,8" Margin="5"/>
                </StackPanel>
            </Grid>
        </TabItem>

        <!-- TAB BALAN√áO -->
        <TabItem Header="Balan√ßo" FontSize="20">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Sele√ß√£o apenas de ano -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBlock Text="Ano:" Margin="0,0,5,0" VerticalAlignment="Center"/>
                    <TextBox Width="100"
                        Text="{Binding BalancoVM.AnoSelecionado, Mode=TwoWay}"
                        Watermark="Ano"/>
                    <TextBlock Text="(Visualiza√ß√£o anual - 12 meses)" 
                            Margin="15,0,0,0" 
                            VerticalAlignment="Center"
                            Foreground="Gray"
                            FontSize="11"/>
                </StackPanel>

                <!-- Tabela -->
                <DataGrid Grid.Row="1"
                        x:Name="BalancoDataGrid"
                        ItemsSource="{Binding BalancoVM.Balancos}"
                        AutoGenerateColumns="False"
                        GridLinesVisibility="All"
                        SelectionMode="Extended"
                        CanUserReorderColumns="True"
                        CanUserResizeColumns="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="M√™s" Binding="{Binding NomeMes}" IsReadOnly="True" Width="*"/>
                        <DataGridTextColumn Header="Renda Bruta" Binding="{Binding RendaBruta, StringFormat='C2'}" IsReadOnly="True" Width="*"/>
                        <DataGridTextColumn Header="Custo Total" Binding="{Binding CustoTotal, StringFormat='C2'}" IsReadOnly="True" Width="*"/>
                        <DataGridTextColumn Header="Margem Lucro" Binding="{Binding MargemLucro, StringFormat='C2'}" IsReadOnly="True" Width="*"/>
                        <DataGridTextColumn Header="% Lu√≠s" Binding="{Binding PercentualLuis}" Width="80"/>
                        <DataGridTextColumn Header="% Pedro" Binding="{Binding PercentualPedro}" Width="80"/>
                        <DataGridTextColumn Header="% Viveiro" Binding="{Binding PercentualViveiro}" Width="80"/>
                        <DataGridTextColumn Header="R$ Lu√≠s" Binding="{Binding ValorLuis, StringFormat='C2'}" IsReadOnly="True" Width="*"/>
                        <DataGridTextColumn Header="R$ Pedro" Binding="{Binding ValorPedro, StringFormat='C2'}" IsReadOnly="True" Width="*"/>
                        <DataGridTextColumn Header="R$ Viveiro" Binding="{Binding ValorViveiro, StringFormat='C2'}" IsReadOnly="True" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Bot√µes -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                    <Button Content="Salvar" 
                            Command="{Binding BalancoVM.SalvarBalancosCommand}"
                            Background="#2196F3" Foreground="White"
                            Padding="20,8" Margin="5"/>
                </StackPanel>
            </Grid>
        </TabItem>
    </TabControl>
</Window>