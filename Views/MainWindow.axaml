<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:GerenciadorViveiro.ViewModels"
        xmlns:converters="using:GerenciadorViveiro"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="550"
        x:Class="GerenciadorViveiro.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Gerenciador de Vendas"
        Width="900" Height="550">

    <Window.Resources>
        <converters:DecimalConverter x:Key="DecimalConverter"/>
    </Window.Resources>

    <TabControl SelectionChanged="OnTabSelectionChanged">
        <TabItem Header="Vendas" FontSize="20">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- filtro -->
                    <RowDefinition Height="*"/>    <!-- tabela -->
                    <RowDefinition Height="Auto"/> <!-- botões -->
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0"
                            Orientation="Horizontal"
                            VerticalAlignment="Top"
                            Margin="0,0,0,8">

                    <TextBlock Text="Cliente:"
                            VerticalAlignment="Center"
                            Margin="0,0,6,0"/>

                    <TextBox Width="180"
                            Height="28"
                            Watermark="Filtrar..."
                            Text="{Binding FiltroCliente, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>

                <!-- Tabela -->
                <Border Grid.Row="1"
                    BorderBrush="#CCCCCC"
                    BorderThickness="1"
                    CornerRadius="5">
                    <DataGrid x:Name="VendasDataGrid"
                        ItemsSource="{Binding VendasFiltradas}"
                        AutoGenerateColumns="False"
                        IsReadOnly="False"
                        GridLinesVisibility="All"
                        SelectionMode="Extended"
                        CanUserReorderColumns="True"
                        CanUserResizeColumns="True">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="Data" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Data, StringFormat='{}{0:dd/MM/yyyy}'}" 
                                                VerticalAlignment="Center" 
                                                Margin="5,0"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <CalendarDatePicker SelectedDate="{Binding Data, Mode=TwoWay}" 
                                                            HorizontalAlignment="Stretch"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Planta" 
                                                Binding="{Binding Planta}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="Quantidade" 
                                                Binding="{Binding Quantidade}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="Valor unitário" 
                                                Binding="{Binding Valor, Converter={StaticResource DecimalConverter}}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="Valor total" 
                                                Binding="{Binding ValorTotal, StringFormat='C2'}" 
                                                IsReadOnly="True"
                                                Width="*"/>
                            <DataGridTextColumn Header="Cliente" 
                                                Binding="{Binding Cliente}" 
                                                Width="*"/>
                            <DataGridTemplateColumn Header="Forma de Pagamento" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding FormaPagamento}" 
                                                VerticalAlignment="Center" 
                                                Margin="5,0"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <ComboBox SelectedItem="{Binding FormaPagamento, Mode=TwoWay}"
                                                HorizontalAlignment="Stretch">
                                            <x:String>Dinheiro</x:String>
                                            <x:String>Pix</x:String>
                                            <x:String>Cartão de Crédito</x:String>
                                            <x:String>Cartão de Débito</x:String>
                                            <x:String>Cheque</x:String>
                                            <x:String>Anotado</x:String>
                                        </ComboBox>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
                <!-- Botões -->
                <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,10,0,0">
                    <Button Content="Nova Linha" 
                            Command="{Binding AdicionarLinhaCommand}"
                            Background="#4CAF50" Foreground="White"
                            Padding="20,8" Margin="5"/>
                    <Button Content="Excluir Linha(s)" 
                            Command="{Binding ExcluirLinhasCommand}"
                            Background="#F44336" Foreground="White"
                            Padding="20,8" Margin="5"/>
                    <Button Content="Salvar" 
                            Command="{Binding SalvarCommand}"
                            Background="#2196F3" Foreground="White"
                            Padding="20,8" Margin="5"/>
                </StackPanel>
            </Grid>
        </TabItem>
        
        <TabItem Header="Frequências" Tapped="CalcularFrequencias" FontSize="20" >
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal"
                            Margin="0,0,0,10">

                    <TextBlock Text="Ano:"
                            VerticalAlignment="Center"
                            Margin="0,0,5,0"/>

                    <TextBox Width="100"
                        Text="{Binding AnoSelecionado, Mode=TwoWay}"
                        Watermark="Ano"/>

                    <TextBlock Text="Mês:"
                            VerticalAlignment="Center"
                            Margin="15,0,5,0"/>

                    <TextBox Width="80"
                        Margin="15,0,0,0"
                        Text="{Binding MesSelecionado, Mode=TwoWay}"
                        Watermark="Mês (1–12)"/>
                </StackPanel>

                <!-- Tabela -->
                <Border Grid.Row="1" BorderBrush="#CCCCCC" BorderThickness="1" 
                        CornerRadius="5">
                    <DataGrid x:Name="FrequenciasGrid"
                        ItemsSource="{Binding Frequencias}"
                        AutoGenerateColumns="False"
                        IsReadOnly="False"
                        GridLinesVisibility="All"
                        SelectionMode="Extended"
                        CanUserReorderColumns="True"
                        CanUserResizeColumns="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Planta"
                                                Binding="{Binding Planta}" 
                                                IsReadOnly="True"
                                                Width="*"/>
                            <DataGridTextColumn Header="Quantidade" 
                                                Binding="{Binding Quantidade}"
                                                IsReadOnly="True" 
                                                Width="*"/>
                            <DataGridTextColumn Header="Valor" 
                                                Binding="{Binding Valor, Converter={StaticResource DecimalConverter}}" 
                                                IsReadOnly="True"
                                                Width="*"/>
                            <DataGridTextColumn Header="Valor total" 
                                                Binding="{Binding ValorTotal, StringFormat='C2'}" 
                                                IsReadOnly="True"
                                                Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </Grid>
        </TabItem>
        <TabItem Header="Custos" FontSize="20">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Seleção mês/ano -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBlock Text="Ano:" Margin="0,0,5,0"/>
                    <TextBox Width="100"
                        Text="{Binding CustosVM.AnoSelecionado, Mode=TwoWay}"
                        Watermark="Ano"/>

                    <TextBlock Text="Mês:" Margin="15,0,5,0"/>
                    <TextBox Width="80"
                        Margin="15,0,0,0"
                        Text="{Binding CustosVM.MesSelecionado, Mode=TwoWay}"
                        Watermark="Mês (1–12)"/>
                </StackPanel>

                <!-- Tabela -->
                <DataGrid Grid.Row="1"
                        x:Name="CustosDataGrid"
                        ItemsSource="{Binding CustosVM.Custos}"
                        AutoGenerateColumns="False"
                        GridLinesVisibility="All"
                        SelectionMode="Extended"
                        CanUserReorderColumns="True"
                        CanUserResizeColumns="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Atividade" Binding="{Binding Atividade}"/>
                        <DataGridTextColumn Header="Elemento" Binding="{Binding Elemento}"/>
                        <DataGridTextColumn Header="Quantidade" Binding="{Binding Quantidade}"/>
                        <DataGridTextColumn Header="Valor Total" Binding="{Binding ValorTotal}"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Botões -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                    <Button Content="Nova Linha" 
                            Command="{Binding CustosVM.NovaLinhaCommand}"
                            Background="#4CAF50" Foreground="White"
                            Padding="20,8" Margin="5"/>
                    <Button Content="Excluir Linha(s)" 
                            Command="{Binding ExcluirLinhasCommand}"
                            Background="#F44336" Foreground="White"
                            Padding="20,8" Margin="5"/>
                    <Button Content="Salvar" 
                            Command="{Binding CustosVM.SalvarCustosCommand}"
                            Background="#2196F3" Foreground="White"
                            Padding="20,8" Margin="5"/>
                </StackPanel>
            </Grid>
        </TabItem>
    </TabControl>
</Window>